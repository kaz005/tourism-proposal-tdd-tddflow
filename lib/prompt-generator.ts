import { FormData, TourismResource } from '@/types';

export function generatePrompt(formData: FormData): string {
  const formatResources = (resources: TourismResource[]): string => {
    return resources.map(resource => 
      `${resource.name}（優先度:${resource.priority === 'high' ? '高' : resource.priority === 'medium' ? '中' : '低'}, 魅力度:${'★'.repeat(resource.attractiveness)}, ${resource.uniqueKeyword}）`
    ).join('\n');
  };

  const promptTemplate = `# ─── 精密度ブースト ───
▼生成条件（必須）:
・総文字数 18,000 字以上  
・章ごとに【字数下限】を満たすこと  
・各図表の本文中プレビューを **300 字以上** で具体記述  
・固有名詞・数値・価格・期間・役割分担は "未定" 禁止、必ず仮置きでも記載  
・章末に <<Validation Checklist>> を出力し、❶字数❷必須図表❸審査基準対応 を自己検証  
▼生成条件: detail_level=ultra
▼生成条件: cite_public_stats=yes
▼生成条件: add_english_exec_summary=yes

🎛 インプット変数
	1. 〔地域名〕
	2. 〔地域固有資源リスト〕
	• 書式 資源名（優先度:高/中/低, 魅力度★1-5, 独自性キーワード）  🆕
	• 例）滝と渓流（高, ★★★★★, 未開発エリア）
	3. 〔ターゲット客層〕（富裕層インバウンド / 教育旅行 等）
	4. 〔主要ツアーコンセプト〕（再生型エコツーリズム×ガストロノミー 等）
	5. 〔候補補助金名〕（複数可）
	6. 〔希望初期投資総額〕（万円）
	7. 〔参考売上単価目安〕（例：体験 8 万円 / 宿泊 5 万円）
	8. 〔運営体制の骨格〕（既存 DMO・自治体連携 など）
	9. 〔自由記述フィールド〕（任意 🆕：深掘りしてほしい要素や特殊条件）

# ========== ここからプロンプト本体 ==========

あなたは観光庁補助金審査委員を唸らせる**プロの旅行企画者**です。  
下記インプットを基に、補助金採択率と事業自走性を最大化する  
『高付加価値型観光事業計画書』（A4換算 15〜25 ページ）を日本語で作成してください。

## ▼インプット
〔地域名〕: ${formData.regionName}
〔地域固有資源リスト〕:
${formatResources(formData.resources)}
〔ターゲット客層〕: ${formData.targetCustomers}
〔主要ツアーコンセプト〕: ${formData.tourConcept}
〔候補補助金名〕: ${formData.subsidyPrograms.join(', ')}
〔希望初期投資総額〕: ${formData.initialInvestment}万円
〔参考売上単価目安〕: ${formData.revenueEstimate}
〔運営体制の骨格〕: ${formData.managementStructure}
〔自由記述フィールド〕: ${formData.additionalNotes || '特になし'}

## ▼アウトプット構成と必須要件
1. **I. エグゼクティブサマリー**【字数下限:2,500字】 
   - ビジョン / KBF / 補助金→自走シナリオ  
   - **図**🆕: "企画全体の価値連鎖図" を Fig-1 として挿入（**300字以上**の詳細解説付き）
   - <<Validation Checklist>> ❶字数確認❷図表品質❸審査基準対応
2. **II. 観光振興の現状と補助金審査の視点**【字数下限:2,000字】 
   - 政策トレンド & 本企画の合致度  
   - 【審査基準担保】 的確性, 独創性
   - <<Validation Checklist>> ❶字数確認❷統計データ引用❸政策整合性
3. **III. 独自性と地域貢献を核とした旅行企画**【字数下限:3,500字】 
   - 〔地域固有資源〕の深掘り ⇒ 高付加価値化アイデア≥3  
   - 体験行程サンプル（Fig-2 フローチャート🆕）（**300字以上**の詳細解説付き）
   - 地域共創スキーム  
   - 【審査基準担保】 独創性, 地域共創, 高付加価値コンテンツ
   - <<Validation Checklist>> ❶字数確認❹独自性要素❸他地域との差別化
4. **IV. 自走可能な収益モデル**【字数下限:3,000字】 
   - 複数収益源ポートフォリオ  
   - 5 年 P/L シミュレーション（Fig-3 棒グラフ🆕）（**300字以上**の詳細解説付き）
   - 【審査基準担保】 収益性, 継続性, DX
   - <<Validation Checklist>> ❶字数確認❷数値根拠❸収益持続性
5. **V. 参考・先行事例との比較分析**【字数下限:2,500字】 
   - 国内外 3-5 例を表形式で比較（Table-1）（**300字以上**の詳細解説付き）
   - <<Validation Checklist>> ❶字数確認❷事例数❸比較軸の妥当性
6. **VI. プロジェクト実現ロードマップ & KPI**【字数下限:2,500字】 
   - 4 フェーズ Gantt（Fig-4 🆕）と KPI 表（Table-2）（各**300字以上**の詳細解説付き）
   - 【審査基準担保】 確実性, 継続性
   - <<Validation Checklist>> ❶字数確認❷スケジュール実現性❸KPI妥当性
7. **VII. リスク & ミティゲーション**【字数下限:2,000字】 
   - **リスクマトリクス表**🆕（Table-3）（発生確率×影響度、優先度色分け）（**300字以上**の詳細解説付き）
   - <<Validation Checklist>> ❶字数確認❷リスク網羅性❸対策具体性
8. **VIII. 結論 / 審査委員へのクロージングメッセージ**【字数下限:2,000字】 
   - 政策貢献 × 投資価値を強調し、採択メリットを端的に訴求
   - **English Executive Summary**（英語要約500語以上）
   - <<Validation Checklist>> ❶字数確認❷英語要約品質❸訴求力

### ▼スタイル指示
- **審査基準 5 点**（独創性・的確性・確実性・継続性・収益性）と  
  **加点項目**（高付加価値・地域共創・DX 等）が  
  "どの節で担保されるか" を【審査基準担保】欄で明示。🆕
- 推計数値は必ず **計算式 or 出典** を括弧内に記載。  
- 長文の連続を避け、H1>H2>H3 と箇条書きを多用。  
- 図表タグ（Table X / Fig X）を入れ、あとから PPT 転用しやすく。

### ▼ボリュームオプション（必要なら追加）🆕
- \`▼生成条件: エグゼクティブサマリー3ページ + 詳細版20ページの2部構成\`
- \`▼生成条件: 観光DX活用を深掘りし、他セクションは 60% に短縮\`  
- \`▼生成条件: 英語版 Executive Summary も併記\`

# 出力を開始してください
# ========== ここまでプロンプト本体 ==========`;

  return promptTemplate;
}